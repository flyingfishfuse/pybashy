<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
<meta http-equiv="X-UA-Compatible" content="IE=Edge">
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="shortcut icon" href="/htdocs/favicon.ico">
<script type="text/javascript" src="/htdocs/bugstatus.js"></script>
<meta http-equiv="Content-Type" content="text/html;charset=utf-8">
<meta name="robots" content="index,nofollow">

<title>PXEBootInstall - Debian Wiki</title>
<script type="text/javascript" src="/htdocs/common/js/common.js"></script>

<script type="text/javascript">
<!--
var search_hint = "Search";
//-->
</script>


<link rel="stylesheet" type="text/css" charset="utf-8" media="all" href="/htdocs/debwiki/css/common.css">
<link rel="stylesheet" type="text/css" charset="utf-8" media="screen" href="/htdocs/debwiki/css/screen.css">
<link rel="stylesheet" type="text/css" charset="utf-8" media="print" href="/htdocs/debwiki/css/print.css">
<link rel="stylesheet" type="text/css" charset="utf-8" media="projection" href="/htdocs/debwiki/css/projection.css">
<link rel="stylesheet" type="text/css" charset="utf-8" media="all" href="/htdocs/debian-wiki-1.0.css">

<!-- css only for MS IE6/IE7 browsers -->
<!--[if lt IE 8]>
   <link rel="stylesheet" type="text/css" charset="utf-8" media="all" href="/htdocs/debwiki/css/msie.css">
<![endif]-->


<link rel="alternate" title="Debian Wiki: PXEBootInstall" href="/PXEBootInstall?diffs=1&amp;show_att=1&amp;action=rss_rc&amp;unique=0&amp;page=PXEBootInstall&amp;ddiffs=1" type="application/rss+xml">


<link rel="Start" href="/FrontPage">
<link rel="Alternate" title="Wiki Markup" href="/PXEBootInstall?action=raw">
<link rel="Alternate" media="print" title="Print View" href="/PXEBootInstall?action=print">
<link rel="Search" href="/FindPage">
<link rel="Index" href="/TitleIndex">
<link rel="Glossary" href="/WordIndex">
<link rel="Help" href="/HelpOnFormatting">
</head>

<body  lang="en" dir="ltr">
<div id="logo"><a href="https://www.debian.org" title="Debian Homepage"><img src="https://www.debian.org/Pics/openlogo-50.png" alt="Debian" width="50" height="61"></a></div>
<div id="header">
<div id="wikisection">
<p class="section"><a href="/FrontPage" title="Debian Wiki Homepage">Wiki</a></p>
<div id="username"><a href="/PXEBootInstall?action=login" id="login" rel="nofollow">Login</a></div>
</div>
<div id="navbar">

<ul id="navibar">
<li class="wikilink"><a href="/FrontPage">FrontPage</a></li><li class="wikilink"><a href="/RecentChanges">RecentChanges</a></li><li class="wikilink"><a href="/FindPage">FindPage</a></li><li class="wikilink"><a href="/HelpContents">HelpContents</a></li><li class="current"><a href="/PXEBootInstall">PXEBootInstall</a></li>
</ul>

</div>

<form id="searchform" method="get" action="/PXEBootInstall">
<div>
<input type="hidden" name="action" value="fullsearch">
<input type="hidden" name="context" value="180">
<label for="searchinput">Search:</label>
<input id="searchinput" type="text" name="value" value="" size="20"
    onfocus="searchFocus(this)" onblur="searchBlur(this)"
    onkeyup="searchChange(this)" onchange="searchChange(this)" alt="Search">
<input id="titlesearch" name="titlesearch" type="submit"
    value="Titles" alt="Search Titles">
<input id="fullsearch" name="fullsearch" type="submit"
    value="Text" alt="Search Full Text">
</div>
</form>
<script type="text/javascript">
<!--// Initialize search form
var f = document.getElementById('searchform');
f.getElementsByTagName('label')[0].style.display = 'none';
var e = document.getElementById('searchinput');
searchChange(e);
searchBlur(e);
//-->
</script>

<div id="logo"><a href="https://www.debian.org" title="Debian Homepage"><img src="https://www.debian.org/Pics/openlogo-50.png" alt="Debian" width="50" height="61"></a></div>

<div id="breadcrumbs"><a href="/FrontPage" title="Debian Wiki Homepage">Wiki</a><span class="sep">/</span>

</div>

<ul class="editbar"><li><a href="/PXEBootInstall?action=login" id="login-1" rel="nofollow">Login</a></li><li class="toggleCommentsButton" style="display:none;"><a href="#" class="nbcomment" onClick="toggleComments();return false;">Comments</a></li><li><a class="nbinfo" href="/PXEBootInstall?action=info" rel="nofollow">Info</a></li><li><a class="nbattachments" href="/PXEBootInstall?action=AttachFile" rel="nofollow">Attachments</a></li><li>
<form class="actionsmenu" method="GET" action="/PXEBootInstall">
<div>
    <label>More Actions:</label>
    <select name="action"
        onchange="if ((this.selectedIndex != 0) &&
                      (this.options[this.selectedIndex].disabled == false)) {
                this.form.submit();
            }
            this.selectedIndex = 0;">
        <option value="raw">Raw Text</option>
<option value="print">Print View</option>
<option value="RenderAsDocbook">Render as Docbook</option>
<option value="refresh">Delete Cache</option>
<option value="show" disabled class="disabled">------------------------</option>
<option value="SpellCheck">Check Spelling</option>
<option value="LikePages">Like Pages</option>
<option value="LocalSiteMap">Local Site Map</option>
<option value="show" disabled class="disabled">------------------------</option>
<option value="RenamePage" disabled class="disabled">Rename Page</option>
<option value="DeletePage" disabled class="disabled">Delete Page</option>
<option value="show" disabled class="disabled">------------------------</option>
<option value="show" disabled class="disabled">Subscribe User</option>
<option value="show" disabled class="disabled">------------------------</option>
<option value="show" disabled class="disabled">Remove Spam</option>
<option value="show" disabled class="disabled">Revert to this revision</option>
<option value="PackagePages">Package Pages</option>
<option value="show" disabled class="disabled">------------------------</option>
<option value="Load">Load</option>
<option value="Save">Save</option>
<option value="SlideShow">SlideShow</option>
    </select>
    <input type="submit" value="Do">
    
</div>
<script type="text/javascript">
<!--// Init menu
actionsMenuInit('More Actions:');
//-->
</script>
</form>
</li></ul>

<h1 id="locationline">


<ul id="pagelocation">
<li><a href="/PXEBootInstall">PXEBootInstall</a></li>
</ul>

</h1>
</div>

<div id="page" lang="en" dir="ltr">
<div dir="ltr" id="content" lang="en"><span class="anchor" id="top"></span>
<span class="anchor" id="line-1"></span><span class="anchor" id="line-2"></span><p class="line867">
<h1 id="Installing_Debian_using_network_booting">Installing Debian using network booting</h1>
<span class="anchor" id="line-3"></span><span class="anchor" id="line-4"></span><p class="line867"><div class="table-of-contents"><p class="table-of-contents-heading">Contents<ol><li>
<a href="#Installing_Debian_using_network_booting">Installing Debian using network booting</a><ol><li>
<a href="#Preface">Preface</a></li><li>
<a href="#Preconditions">Preconditions</a></li><li>
<a href="#Activate_PXE_boot">Activate PXE boot</a></li><li>
<a href="#Set_up_DHCP_server">Set up DHCP server</a></li><li>
<a href="#Set_up_TFTP_server">Set up TFTP server</a></li><li>
<a href="#Provide_the_boot_image">Provide the boot image</a></li><li>
<a href="#Alternative_way_to_obtain_the_boot_image">Alternative way to obtain the boot image</a></li><li>
<a href="#Another_Way_-_use_Dnsmasq">Another Way - use Dnsmasq</a></li><li>
<a href="#Potential_Issues">Potential Issues</a></li><li>
<a href="#See_Also">See Also</a></li></ol></li></ol></div> <span class="anchor" id="line-5"></span><span class="anchor" id="line-6"></span><p class="line867">
<h2 id="Preface">Preface</h2>
<span class="anchor" id="line-7"></span><span class="anchor" id="line-8"></span><p class="line862">Installation using network booting must not be confused with <a href="/DebianNetworkInstall">DebianNetworkInstall</a>. In network install, you start with a CD (or USB flash memory or similar) to install a minimal Linux system before you proceed to download further packages over the network.  <span class="anchor" id="line-9"></span><span class="anchor" id="line-10"></span><p class="line862">Installation using network booting is also different from using the network to boot an <strong>already</strong>-installed system: in which case, the client machine remains dependent on the server being up and running at every future boot. The  Linux Terminal Server Project (<a href="/LTSP">LTSP</a>) works like that, for example. <span class="anchor" id="line-11"></span><span class="anchor" id="line-12"></span><p class="line874">This page describes installing a new Debian system with no CD, DVD, USB at all. By the end of the installation process, the new machine is able to run without the support of the server. During the installation, you will need a network boot server. <span class="anchor" id="line-13"></span><span class="anchor" id="line-14"></span><p class="line874">As there are no fiducial boot servers out in the wild, you need to set up your own. This is considerably more complicated than installing Debian from CD (shorthand for CD or USB or ...). Normally, network booting is only used if there is really no way to boot from CD. If booting from CD fails, this may be due to BIOS problems that will equally prevent network booting (typical troubleshooting attempts include switching off secure booting, switching from UEFI to legacy boot mode, and similar). <span class="anchor" id="line-15"></span><span class="anchor" id="line-16"></span><p class="line874">In the Web, several articles can be found that describe in more or less detail how to setup a network boot server. They all have the same weakness: you are required to execute a long list of instructions without getting any feedback before the very end of the procedure when you try to boot. If it works, fine. If not, debugging will become very very difficult. Therefore, in the following, we break down the procedure into steps that can be debugged separately.  <span class="anchor" id="line-17"></span><span class="anchor" id="line-18"></span><p class="line867"><span class="anchor" id="line-19"></span><div class="debian"><span class="anchor" id="line-1-1"></span><p class="line867"><a class="http" href="http://www.debian.org/releases/stable/amd64/ch04s05">http://www.debian.org/releases/stable/amd64/ch04s05</a> - Debian Installation Guide - 4.5. Preparing Files for TFTP Net Booting </div><span class="anchor" id="line-20"></span><span class="anchor" id="line-21"></span><p class="line862">Note: If your system supports iPXE, then using <a class="https" href="https://netboot.xyz/">netboot.xyz</a> is likely to be much simpler. <span class="anchor" id="line-22"></span><span class="anchor" id="line-23"></span><p class="line867">
<h2 id="Preconditions">Preconditions</h2>
<span class="anchor" id="line-24"></span><span class="anchor" id="line-25"></span><p class="line874">The computer you want to install to will be called the Client. <span class="anchor" id="line-26"></span><span class="anchor" id="line-27"></span><p class="line874">The computer you install from will be called the Server. We assume that the Server is running Debian. <span class="anchor" id="line-28"></span><span class="anchor" id="line-29"></span><p class="line874">To be specific, we assume that the Client and the Server are part of a LAN with the following IP addresses: <span class="anchor" id="line-30"></span><ul><li>192.168.0.1 router (i.e. LAN default gateway) and DNS recursive server <span class="anchor" id="line-31"></span></li><li>192.168.0.2 the Server (will host a DHCP and TFTP server) <span class="anchor" id="line-32"></span></li><li>192.168.0.x the Client <span class="anchor" id="line-33"></span></li></ul><p class="line874">You will find out the value of x later. <span class="anchor" id="line-34"></span><span class="anchor" id="line-35"></span><p class="line874">Note that many routers also provide a DHCP server: you will have to turn it off, since only one DHCP server can run in a given LAN. Unless you may configure your router's DHCP server to comply with the ISC DHCP server configuration below, but this is outside of the scope of this document. <span class="anchor" id="line-36"></span><span class="anchor" id="line-37"></span><p class="line874">It is also possible that the router and the server are the same machine, i.e. that your Debian server is the default gateway for this LAN. This will work fine. <span class="anchor" id="line-38"></span><span class="anchor" id="line-39"></span><p class="line874">The following instructions have been tested with Debian 8.2 (Jessie) in September 2015. <span class="anchor" id="line-40"></span><span class="anchor" id="line-41"></span><p class="line867">
<h2 id="Activate_PXE_boot">Activate PXE boot</h2>
<span class="anchor" id="line-42"></span><span class="anchor" id="line-43"></span><p class="line874">Setup the BIOS boot menu of the Client to boot from the network. <span class="anchor" id="line-44"></span><span class="anchor" id="line-45"></span><p class="line874">Reboot. On most systems, this produces an output that contains the Client's MAC address. Then, it will fail with <span class="anchor" id="line-46"></span><span class="anchor" id="line-47"></span><span class="anchor" id="line-48"></span><pre><span class="anchor" id="line-1"></span>  PXE-E53: no boot filename received.</pre><span class="anchor" id="line-49"></span><p class="line874">Note the MAC address; it will be helpful for interpreting log messages. <span class="anchor" id="line-50"></span><span class="anchor" id="line-51"></span><p class="line874">On many servers, it is also possible to temporary switch to PXE boot without permanently changing the BIOS settings. There will be some kind of keystroke to hit during BIOS POST. On Dell servers, F12 will do the trick (or Esc then @ from a serial or IPMI console). <span class="anchor" id="line-52"></span><span class="anchor" id="line-53"></span><p class="line867">
<h2 id="Set_up_DHCP_server">Set up DHCP server</h2>
<span class="anchor" id="line-54"></span><span class="anchor" id="line-55"></span><p class="line874">On the Server, we need to set up a DHCP server. <span class="anchor" id="line-56"></span><span class="anchor" id="line-57"></span><p class="line862">Current best practice seems to be to use the package <a class="interwiki" href="https://packages.debian.org/isc-dhcp-server" title="DebianPkg">isc-dhcp-server</a>, which provides a daemon <em>dhcpd</em>. <span class="anchor" id="line-58"></span><span class="anchor" id="line-59"></span><p class="line862">Its configuration file is <em>/etc/dhcp/dhcpd.conf</em>. Modify this file so that it contains about the following; adapt IP and MAC addresses to your local needs: <span class="anchor" id="line-60"></span><span class="anchor" id="line-61"></span><p class="line867"><span class="anchor" id="line-62"></span><span class="anchor" id="line-63"></span><span class="anchor" id="line-64"></span><span class="anchor" id="line-65"></span><span class="anchor" id="line-66"></span><span class="anchor" id="line-67"></span><span class="anchor" id="line-68"></span><span class="anchor" id="line-69"></span><span class="anchor" id="line-70"></span><span class="anchor" id="line-71"></span><span class="anchor" id="line-72"></span><span class="anchor" id="line-73"></span><span class="anchor" id="line-74"></span><span class="anchor" id="line-75"></span><span class="anchor" id="line-76"></span><span class="anchor" id="line-77"></span><span class="anchor" id="line-78"></span><span class="anchor" id="line-79"></span><span class="anchor" id="line-80"></span><span class="anchor" id="line-81"></span><span class="anchor" id="line-82"></span><span class="anchor" id="line-83"></span><span class="anchor" id="line-84"></span><span class="anchor" id="line-85"></span><span class="anchor" id="line-86"></span><span class="anchor" id="line-87"></span><pre><span class="anchor" id="line-1-1"></span>default-lease-time 600;
<span class="anchor" id="line-2"></span>max-lease-time 7200;
<span class="anchor" id="line-3"></span>
<span class="anchor" id="line-4"></span>allow booting;
<span class="anchor" id="line-5"></span>
<span class="anchor" id="line-6"></span># in this example, we serve DHCP requests from 192.168.0.(3 to 253)
<span class="anchor" id="line-7"></span># and we have a router at 192.168.0.1
<span class="anchor" id="line-8"></span>subnet 192.168.0.0 netmask 255.255.255.0 {
<span class="anchor" id="line-9"></span>  range 192.168.0.3 192.168.0.253;
<span class="anchor" id="line-10"></span>  option broadcast-address 192.168.0.255;
<span class="anchor" id="line-11"></span>  option routers 192.168.0.1;             # our router
<span class="anchor" id="line-12"></span>  option domain-name-servers 192.168.0.1; # our router, again
<span class="anchor" id="line-13"></span>  filename &quot;pxelinux.0&quot;; # (this we will provide later)
<span class="anchor" id="line-14"></span>}
<span class="anchor" id="line-15"></span>
<span class="anchor" id="line-16"></span>group {
<span class="anchor" id="line-17"></span>  next-server 192.168.0.2;                # our Server
<span class="anchor" id="line-18"></span>  host tftpclient {
<span class="anchor" id="line-19"></span>    if option architecture-type = 00:07 {
<span class="anchor" id="line-20"></span>      filename &quot;debian-installer/amd64/bootnetx64.efi&quot;;
<span class="anchor" id="line-21"></span>    } else {
<span class="anchor" id="line-22"></span>      filename &quot;pxelinux.0&quot;;
<span class="anchor" id="line-23"></span>    }
<span class="anchor" id="line-24"></span>  }
<span class="anchor" id="line-25"></span>}</pre><span class="anchor" id="line-88"></span><span class="anchor" id="line-89"></span><span class="anchor" id="line-90"></span><p class="line874">After each modification of the above, restart the DHCP server with <span class="anchor" id="line-91"></span><span class="anchor" id="line-92"></span><span class="anchor" id="line-93"></span><pre><span class="anchor" id="line-1-2"></span>  # /etc/init.d/isc-dhcp-server restart</pre><span class="anchor" id="line-94"></span><p class="line874">or with the systemd equivalent <span class="anchor" id="line-95"></span><span class="anchor" id="line-96"></span><span class="anchor" id="line-97"></span><pre><span class="anchor" id="line-1-3"></span>  # systemctl restart isc-dhcp-server</pre><span class="anchor" id="line-98"></span><span class="anchor" id="line-99"></span><p class="line874">Check that it is actually running: <span class="anchor" id="line-100"></span><span class="anchor" id="line-101"></span><span class="anchor" id="line-102"></span><span class="anchor" id="line-103"></span><pre><span class="anchor" id="line-1-4"></span>  # pgrep -lf dhcpd
<span class="anchor" id="line-2-1"></span>  32277 /usr/sbin/dhcpd -q</pre><span class="anchor" id="line-104"></span><p class="line874">or <span class="anchor" id="line-105"></span><span class="anchor" id="line-106"></span><span class="anchor" id="line-107"></span><pre><span class="anchor" id="line-1-5"></span>  # systemctl status isc-dhcp-server</pre><span class="anchor" id="line-108"></span><p class="line874">which gives slightly more information. <span class="anchor" id="line-109"></span><span class="anchor" id="line-110"></span><p class="line874">Before rebooting the client, you may like to run <span class="anchor" id="line-111"></span><span class="anchor" id="line-112"></span><span class="anchor" id="line-113"></span><pre><span class="anchor" id="line-1-6"></span>  # journalctl -fu isc-dhcp-server</pre><span class="anchor" id="line-114"></span><p class="line874">which shows you the last few lines of the DHCP server log, then updates the screen with each new log entry. (If you do not want to &quot;follow&quot; the log, just leave out the &quot;f&quot;) <span class="anchor" id="line-115"></span><span class="anchor" id="line-116"></span><p class="line874">Reboot the Client. On success, it will output the IP addresses of the Server (&quot;DHCP&quot;), of the router (&quot;Gateway&quot;) and of itself (192.168.0.x). Then it will hang with a TFTP request, and finally write the error message: <span class="anchor" id="line-117"></span><span class="anchor" id="line-118"></span><span class="anchor" id="line-119"></span><pre><span class="anchor" id="line-1-7"></span>  PXE-E32: TFTP open timeout</pre><span class="anchor" id="line-120"></span><p class="line874">and at the same time, you will see log messages on the server screen showing the DHCP requests and offers similar to the output below the alternative command below <span class="anchor" id="line-121"></span><span class="anchor" id="line-122"></span><p class="line874">If you prefer not to use systemd, or wish to compare the traditional log output for diagnostic purposes, you can look up /var/log/syslog, for example with this command <span class="anchor" id="line-123"></span><span class="anchor" id="line-124"></span><span class="anchor" id="line-125"></span><pre><span class="anchor" id="line-1-8"></span>  # grep DHCP /var/log/syslog</pre><span class="anchor" id="line-126"></span><ul><li style="list-style-type:none">where you should see something like: <span class="anchor" id="line-127"></span></li></ul><p class="line867"><span class="anchor" id="line-128"></span><span class="anchor" id="line-129"></span><span class="anchor" id="line-130"></span><span class="anchor" id="line-131"></span><span class="anchor" id="line-132"></span><pre><span class="anchor" id="line-1-9"></span>Jun  3 09:53:46 server dhcpd: DHCPDISCOVER from 40:01:1c:47:44:1e via eth0
<span class="anchor" id="line-2-2"></span>Jun  3 09:53:47 server dhcpd: DHCPOFFER on 192.168.0.3 to 40:01:1c:47:44:1e via eth0
<span class="anchor" id="line-3-1"></span>Jun  3 09:53:51 server dhcpd: DHCPREQUEST for 192.168.0.3 (192.168.0.2) from 40:01:1c:47:44:1e via eth0
<span class="anchor" id="line-4-1"></span>Jun  3 09:53:51 server dhcpd: DHCPACK on 192.168.0.3 to 40:01:1c:47:44:1e via eth0</pre><span class="anchor" id="line-133"></span><p class="line874">(Note that earlier Debian releases used /var/log/daemon.log instead of syslog) <span class="anchor" id="line-134"></span><span class="anchor" id="line-135"></span><p class="line862">If nothing appears in the log with either command, check the network links between the Server and the Client. Note that some network switches may impose severe limitations on DHCP traffic; for Cisco ones, use 'portfast' if possible (see <a class="http" href="http://www.cisco.com/en/US/products/hw/switches/ps708/products_tech_note09186a00800b1500.shtml">http://www.cisco.com/en/US/products/hw/switches/ps708/products_tech_note09186a00800b1500.shtml</a>). <span class="anchor" id="line-136"></span><span class="anchor" id="line-137"></span><span class="anchor" id="line-138"></span><p class="line867">
<h2 id="Set_up_TFTP_server">Set up TFTP server</h2>
<span class="anchor" id="line-139"></span><span class="anchor" id="line-140"></span><p class="line874">Next, we need to set up a TFTP server on the Server. <span class="anchor" id="line-141"></span><span class="anchor" id="line-142"></span><p class="line862">Again, there are several packages that provide TFTP (trivial FTP, unsafe, to be used in LAN's only). It seems best practice to use the package <a class="interwiki" href="https://packages.debian.org/tftpd-hpa" title="DebianPkg">tftpd-hpa</a>. On installation, a few questions are asked. The response to these questions goes into a configuration file, <em>/etc/default/tftpd-hpa</em>. There should be no need to modify the following default contents: <span class="anchor" id="line-143"></span><span class="anchor" id="line-144"></span><p class="line867"><span class="anchor" id="line-145"></span><span class="anchor" id="line-146"></span><span class="anchor" id="line-147"></span><span class="anchor" id="line-148"></span><span class="anchor" id="line-149"></span><pre><span class="anchor" id="line-1-10"></span>  TFTP_USERNAME=&quot;tftp&quot;
<span class="anchor" id="line-2-3"></span>  TFTP_DIRECTORY=&quot;/srv/tftp&quot;
<span class="anchor" id="line-3-2"></span>  TFTP_ADDRESS=&quot;0.0.0.0:69&quot;
<span class="anchor" id="line-4-2"></span>  TFTP_OPTIONS=&quot;--secure&quot;</pre><span class="anchor" id="line-150"></span><span class="anchor" id="line-151"></span><p class="line874">Ignore older Web sites that instruct you to insert something like 'RUN_DAEMON=&quot;yes&quot;'. <span class="anchor" id="line-152"></span><span class="anchor" id="line-153"></span><p class="line874">After each modification of the above configuration file, restart the TFTP server with <span class="anchor" id="line-154"></span><span class="anchor" id="line-155"></span><span class="anchor" id="line-156"></span><pre><span class="anchor" id="line-1-11"></span>  # /etc/init.d/tftpd-hpa restart</pre><span class="anchor" id="line-157"></span><p class="line874">or <span class="anchor" id="line-158"></span><span class="anchor" id="line-159"></span><span class="anchor" id="line-160"></span><pre><span class="anchor" id="line-1-12"></span>  # systemctl restart tftpd-hpa</pre><span class="anchor" id="line-161"></span><span class="anchor" id="line-162"></span><p class="line874">On Jessie, the directory /srv/tftp will be automatically created. This means the next two steps are not necessary if you use Jessie. <span class="anchor" id="line-163"></span><span class="anchor" id="line-164"></span><p class="line874">Initially, on pre-Jessie versions, restarting the TFTP server might fail with a message like <span class="anchor" id="line-165"></span><span class="anchor" id="line-166"></span><span class="anchor" id="line-167"></span><pre><span class="anchor" id="line-1-13"></span>  Restarting HPA's tftpd: in.tftpd/srv/tftp missing, aborting.</pre><span class="anchor" id="line-168"></span><span class="anchor" id="line-169"></span><p class="line862">Therefore, as root, create the directory <em>/srv/tftp</em>. Restart the TFTP daemon. Check that it is actually running: <span class="anchor" id="line-170"></span><span class="anchor" id="line-171"></span><span class="anchor" id="line-172"></span><span class="anchor" id="line-173"></span><pre><span class="anchor" id="line-1-14"></span>  # pgrep -lf tftpd
<span class="anchor" id="line-2-4"></span>  12555 /usr/sbin/in.tftpd</pre><span class="anchor" id="line-174"></span><p class="line874">or <span class="anchor" id="line-175"></span><span class="anchor" id="line-176"></span><span class="anchor" id="line-177"></span><pre><span class="anchor" id="line-1-15"></span>  # systemctl status tftpd-hpa</pre><span class="anchor" id="line-178"></span><p class="line874">which again gives a few lines of the log rather than just the fact that the task is (isn't) running.  <span class="anchor" id="line-179"></span><span class="anchor" id="line-180"></span><p class="line862">It is useful to test your TFTP server with a TFTP client; you may simply use the <a class="interwiki" href="https://packages.debian.org/tftp-hpa" title="DebianPkg">tftp-hpa</a> package for this purpose: <span class="anchor" id="line-181"></span><span class="anchor" id="line-182"></span><span class="anchor" id="line-183"></span><span class="anchor" id="line-184"></span><span class="anchor" id="line-185"></span><span class="anchor" id="line-186"></span><span class="anchor" id="line-187"></span><span class="anchor" id="line-188"></span><span class="anchor" id="line-189"></span><pre><span class="anchor" id="line-1-16"></span>  # cd /tmp
<span class="anchor" id="line-2-5"></span>  # uname -a &gt;/srv/tftp/test
<span class="anchor" id="line-3-3"></span>  # tftp 192.168.0.2
<span class="anchor" id="line-4-3"></span>  tftp&gt; get test
<span class="anchor" id="line-5-1"></span>  tftp&gt; quit
<span class="anchor" id="line-6-1"></span>  # diff test /srv/tftp/test
<span class="anchor" id="line-7-1"></span>  (nothing, they are identical)</pre><span class="anchor" id="line-190"></span><p class="line874">It is also useful to see what log entries you get when you download a file that exists, and when you try to download one that doesn't. While using tftp to test your tftpd server, try tracking your experiments with old and new forms of the log command while you are using your TFTP client to download files that do, as well as files that do not, exist. <span class="anchor" id="line-191"></span><span class="anchor" id="line-192"></span><p class="line874">The traditional command on Jessie <span class="anchor" id="line-193"></span><span class="anchor" id="line-194"></span><span class="anchor" id="line-195"></span><pre><span class="anchor" id="line-1-17"></span>  # tail -f /var/log/syslog</pre><span class="anchor" id="line-196"></span><p class="line874">(Note again that earlier Debian releases used /var/log/daemon.log instead of syslog.) <span class="anchor" id="line-197"></span><span class="anchor" id="line-198"></span><p class="line874">On systemd <span class="anchor" id="line-199"></span><span class="anchor" id="line-200"></span><span class="anchor" id="line-201"></span><pre><span class="anchor" id="line-1-18"></span>  # journalctl -fu tftpd-hpa</pre><span class="anchor" id="line-202"></span><p class="line874">Sadly, these seem to give different results, as of January 2017. The systemd command does not display file requests for files that do not exist.  <span class="anchor" id="line-203"></span><span class="anchor" id="line-204"></span><p class="line874">It is quite useful to know what the client is asking for, as it helps you move files to the expected location if you make mistakes later on. At present then it is probably worth using the traditional way of log tracking for TFTPD. <span class="anchor" id="line-205"></span><span class="anchor" id="line-206"></span><p class="line874">Reboot the Client. You should see error messages on the client screen starting with <span class="anchor" id="line-207"></span><span class="anchor" id="line-208"></span><span class="anchor" id="line-209"></span><pre><span class="anchor" id="line-1-19"></span>  PXE-T01: File not found</pre><span class="anchor" id="line-210"></span><p class="line874">which is quite correct since we did not yet provide any files. On the server screen, you will see exactly what the client did ask for. <span class="anchor" id="line-211"></span><span class="anchor" id="line-212"></span><p class="line867">
<h2 id="Provide_the_boot_image">Provide the boot image</h2>
<span class="anchor" id="line-213"></span><span class="anchor" id="line-214"></span><p class="line862">Download <em>netboot/netboot.tar.gz</em> from a Debian mirror (see <a class="http" href="http://www.debian.org/distrib/netinst#netboot">http://www.debian.org/distrib/netinst#netboot</a>). <span class="anchor" id="line-215"></span><span class="anchor" id="line-216"></span><p class="line874">Optional: To verify the digital signature, type these commands: <span class="anchor" id="line-217"></span><span class="anchor" id="line-218"></span><span class="anchor" id="line-219"></span><span class="anchor" id="line-220"></span><span class="anchor" id="line-221"></span><span class="anchor" id="line-222"></span><span class="anchor" id="line-223"></span><span class="anchor" id="line-224"></span><span class="anchor" id="line-225"></span><span class="anchor" id="line-226"></span><span class="anchor" id="line-227"></span><span class="anchor" id="line-228"></span><span class="anchor" id="line-229"></span><span class="anchor" id="line-230"></span><span class="anchor" id="line-231"></span><span class="anchor" id="line-232"></span><span class="anchor" id="line-233"></span><span class="anchor" id="line-234"></span><span class="anchor" id="line-235"></span><span class="anchor" id="line-236"></span><span class="anchor" id="line-237"></span><span class="anchor" id="line-238"></span><pre><span class="anchor" id="line-1-20"></span># export YOURMIRROR=deb.debian.org # A CDN backed by cloudflare and fastly currently
<span class="anchor" id="line-2-6"></span># export ARCH=amd64
<span class="anchor" id="line-3-4"></span># export DIST=stable
<span class="anchor" id="line-4-4"></span># wget http://&quot;$YOURMIRROR&quot;/debian/dists/$DIST/main/installer-&quot;$ARCH&quot;/current/images/netboot/netboot.tar.gz
<span class="anchor" id="line-5-2"></span># wget http://&quot;$YOURMIRROR&quot;/debian/dists/$DIST/main/installer-&quot;$ARCH&quot;/current/images/SHA256SUMS
<span class="anchor" id="line-6-2"></span># wget http://&quot;$YOURMIRROR&quot;/debian/dists/$DIST/Release
<span class="anchor" id="line-7-2"></span># wget http://&quot;$YOURMIRROR&quot;/debian/dists/$DIST/Release.gpg
<span class="anchor" id="line-8-1"></span>
<span class="anchor" id="line-9-1"></span># sha256sum -c &lt;(awk '/netboot\/netboot.tar.gz/{print $1 &quot; netboot.tar.gz&quot;}' SHA256SUMS)
<span class="anchor" id="line-10-1"></span># # Must print: netboot.tar.gz: OK
<span class="anchor" id="line-11-1"></span>
<span class="anchor" id="line-12-1"></span>
<span class="anchor" id="line-13-1"></span># sha256sum -c &lt;(awk '/[a-f0-9]{64}[[:space:]].*main\/installer-'$ARCH'\/current\/images\/SHA256SUMS/{print $1 &quot; SHA256SUMS&quot;}' Release)
<span class="anchor" id="line-14-1"></span>
<span class="anchor" id="line-15-1"></span># # Must print `SHA256SUMS: OK`
<span class="anchor" id="line-16-1"></span>
<span class="anchor" id="line-17-1"></span># gpg --verify Release.gpg Release
<span class="anchor" id="line-18-1"></span>gpg: WARNING: multiple signatures detected.  Only the first will be checked.
<span class="anchor" id="line-19-1"></span>gpg: Signature made Sat 15 Jun 2013 05:55:56 AM CDT using RSA key ID 473041FA
<span class="anchor" id="line-20-1"></span>gpg: Good signature from &quot;Debian Archive Automatic Signing Key (6.0/squeeze) &lt;ftpmaster@debian.org&gt;&quot;</pre><span class="anchor" id="line-239"></span><span class="anchor" id="line-240"></span><span class="anchor" id="line-241"></span><p class="line862">Unpack netboot.tar.gz to <em>/srv/tftp</em>, which should now contain <span class="anchor" id="line-242"></span><span class="anchor" id="line-243"></span><span class="anchor" id="line-244"></span><span class="anchor" id="line-245"></span><span class="anchor" id="line-246"></span><span class="anchor" id="line-247"></span><pre><span class="anchor" id="line-1-21"></span>  debian-installer/
<span class="anchor" id="line-2-7"></span>  pxelinux.0@
<span class="anchor" id="line-3-5"></span>  pxelinux.cfg@
<span class="anchor" id="line-4-5"></span>  version.info</pre><span class="anchor" id="line-248"></span><span class="anchor" id="line-249"></span><p class="line862">It may be necessary to <em>chmod -R a+r *</em> to make all files in this directory readable for the TFTP daemon. <span class="anchor" id="line-250"></span><span class="anchor" id="line-251"></span><p class="line874">If you are booting with UEFI, you should link grub and grubx64.efi into the root of your tftp directory: <span class="anchor" id="line-252"></span>{{ <span class="anchor" id="line-253"></span># cd /srv/tftp <span class="anchor" id="line-254"></span># ln -s debian-installer/amd64/grubx64.efi . <span class="anchor" id="line-255"></span># ln -s debian-installer/amd64/grub . <span class="anchor" id="line-256"></span>}} <span class="anchor" id="line-257"></span><span class="anchor" id="line-258"></span><p class="line874">You may also have to edit grub/grub.cfg in order to set your serial console, if needed (I replaced the section about the graphical terminal): <span class="anchor" id="line-259"></span><span class="anchor" id="line-260"></span><span class="anchor" id="line-261"></span><span class="anchor" id="line-262"></span><span class="anchor" id="line-263"></span><pre><span class="anchor" id="line-1-22"></span>serial --speed=115200 --unit=1 --word=8 --parity=no --stop=1
<span class="anchor" id="line-2-8"></span>terminal_input console serial
<span class="anchor" id="line-3-6"></span>terminal_output console serial</pre><span class="anchor" id="line-264"></span><p class="line874">as well as the serial console for debian-installer by appending this to the kernel command line: <span class="anchor" id="line-265"></span><span class="anchor" id="line-266"></span><span class="anchor" id="line-267"></span><pre><span class="anchor" id="line-1-23"></span>console=ttyS1,115200n8r console=tty1</pre><span class="anchor" id="line-268"></span><span class="anchor" id="line-269"></span><p class="line874">Restart the TFTP daemon, and again you may like to follow the log entries as they appear <span class="anchor" id="line-270"></span><span class="anchor" id="line-271"></span><span class="anchor" id="line-272"></span><pre><span class="anchor" id="line-1-24"></span>  # tail -f /var/log/syslog</pre><span class="anchor" id="line-273"></span><span class="anchor" id="line-274"></span><p class="line874">HISTORICAL NOTE: /var/log/syslog is right for Jessie -- in earlier Debian versions, if this does not seem to work, also try /var/log/daemon.log <span class="anchor" id="line-275"></span><span class="anchor" id="line-276"></span><p class="line874">then reboot the Client. You should get to a Debian install screen. <span class="anchor" id="line-277"></span><span class="anchor" id="line-278"></span><p class="line874">If you lookup into /var/log/syslog, you will see what has been downloaded from the TFTP server by the PXE bootloader, and then by SYSLINUX. You might also see some &quot;NAK&quot; replies when SYSLINUX asked for files that do not exist (it tries several locations for some important files). <span class="anchor" id="line-279"></span><span class="anchor" id="line-280"></span><span class="anchor" id="line-281"></span><span class="anchor" id="line-282"></span><span class="anchor" id="line-283"></span><span class="anchor" id="line-284"></span><span class="anchor" id="line-285"></span><span class="anchor" id="line-286"></span><pre><span class="anchor" id="line-1-25"></span>Jun  3 09:53:51 server tftpd.in[32698]: Serving pxelinux.0 to 192.168.0.3:2070
<span class="anchor" id="line-2-9"></span>Jun  3 09:53:51 server tftpd.in[32698]: Serving pxelinux.0 to 192.168.0.3:2071
<span class="anchor" id="line-3-7"></span>Jun  3 09:53:51 server tftpd.in[32698]: Serving pxelinux.cfg/44454c4c-5600-1048-8051-c7c04f575831 to 192.168.0.3:57089
<span class="anchor" id="line-4-6"></span>Jun  3 09:53:51 server tftpd.in[32698]: Serving pxelinux.cfg/40-01-b1-1c-47-44-1e to 192.168.0.3:57090
<span class="anchor" id="line-5-3"></span>Jun  3 09:53:51 server tftpd.in[32698]: Serving pxelinux.cfg/default to 192.168.0.3:57090
<span class="anchor" id="line-6-3"></span>Jun  3 09:53:51 server tftpd.in[32698]: Serving bootmenu.txt to 192.168.0.3:57095</pre><span class="anchor" id="line-287"></span><span class="anchor" id="line-288"></span><p class="line874">The PXE loader (the firmware in the BIOS or the network controller of the client) tries to load in this order: <span class="anchor" id="line-289"></span><ul><li>pxelinux.0 (or more exactly, what you told it to download in the 'filename' field of the DHCP response) <span class="anchor" id="line-290"></span><span class="anchor" id="line-291"></span></li></ul><p class="line874">Then SYSLINUX/PXELINUX will try to search its configuration at different paths, from the most specific to the least: <span class="anchor" id="line-292"></span><ul><li>pxelinux.cfg/GUID <span class="anchor" id="line-293"></span></li><li>pxelinux.cfg/MAC <span class="anchor" id="line-294"></span></li><li>pxelinux.cfg/default <span class="anchor" id="line-295"></span><span class="anchor" id="line-296"></span></li></ul><p class="line874">And if the configuration menu depends on other configuration items, they are also downloaded. Debian will at least need the 'bootmenu.txt' file which is the main menu. <span class="anchor" id="line-297"></span><span class="anchor" id="line-298"></span><p class="line874">By default, you arrive at the graphical Debian install start menu screen. Press 'enter' to start installation. Be patient: it may take over a minute before the next screen ('Select a language') appears. <span class="anchor" id="line-299"></span><span class="anchor" id="line-300"></span><p class="line867">
<h2 id="Alternative_way_to_obtain_the_boot_image">Alternative way to obtain the boot image</h2>
<span class="anchor" id="line-301"></span><span class="anchor" id="line-302"></span><p class="line874">If you have a Debian system of the same release as you wish to install, you can install the boot image using apt. <span class="anchor" id="line-303"></span><span class="anchor" id="line-304"></span><p class="line867"><span class="anchor" id="line-305"></span><span class="anchor" id="line-306"></span><span class="anchor" id="line-307"></span><span class="anchor" id="line-308"></span><pre><span class="anchor" id="line-1-26"></span>VERSION=8 # jessie, 7.0 for wheezy
<span class="anchor" id="line-2-10"></span>ARCH=amd64 # or any other release architecture
<span class="anchor" id="line-3-8"></span>apt-get install debian-installer-$VERSION-netboot-$ARCH</pre><span class="anchor" id="line-309"></span><span class="anchor" id="line-310"></span><p class="line862">Now point the tftp server to <tt class="backtick">/usr/lib/debian-installer/images/$VERSION/$ARCH/$INTERFACE</tt> where <tt class="backtick">INTERFACE=text</tt> for the text mode installer or <tt class="backtick">INTERFACE=gtk</tt> for the graphical installer. <span class="anchor" id="line-311"></span>A simple way to achieve this is to turn <tt class="backtick">/srv/tftp</tt> into a symbolic link. <span class="anchor" id="line-312"></span><span class="anchor" id="line-313"></span><p class="line867">
<h2 id="Another_Way_-_use_Dnsmasq">Another Way - use Dnsmasq</h2>
<span class="anchor" id="line-314"></span><span class="anchor" id="line-315"></span><p class="line867"><a class="interwiki" href="https://packages.debian.org/dnsmasq" title="DebianPkg">dnsmasq</a> is a lightweight, easy to configure DNS forwarder and DHCP server with BOOTP/TFTP/PXE functionality. That is, you can replace <a class="interwiki" href="https://packages.debian.org/isc-dhcp-server" title="DebianPkg">isc-dhcp-server</a> and <a class="interwiki" href="https://packages.debian.org/tftpd-hpa" title="DebianPkg">tftpd-hpa</a> with Dnsmasq. <span class="anchor" id="line-316"></span><span class="anchor" id="line-317"></span><p class="line874">Following is the /etc/dnsmasq.conf providing the same functionality as the method of installing and configuration of isc-dhcpd-server and tftpd-hpa described above. <span class="anchor" id="line-318"></span><span class="anchor" id="line-319"></span><p class="line867"><span class="anchor" id="line-320"></span><span class="anchor" id="line-321"></span><span class="anchor" id="line-322"></span><span class="anchor" id="line-323"></span><span class="anchor" id="line-324"></span><span class="anchor" id="line-325"></span><span class="anchor" id="line-326"></span><span class="anchor" id="line-327"></span><pre><span class="anchor" id="line-1-27"></span>interface=eth1
<span class="anchor" id="line-2-11"></span>domain=yourdomain.com
<span class="anchor" id="line-3-9"></span>dhcp-range=192.168.0.3,192.168.0.253,255.255.255.0,1h
<span class="anchor" id="line-4-7"></span>dhcp-boot=pxelinux.0,pxeserver,192.168.0.2
<span class="anchor" id="line-5-4"></span>pxe-service=x86PC, &quot;Install Linux&quot;, pxelinux
<span class="anchor" id="line-6-4"></span>enable-tftp
<span class="anchor" id="line-7-3"></span>tftp-root=/srv/tftp</pre><span class="anchor" id="line-328"></span><span class="anchor" id="line-329"></span><p class="line874">Download the netboot.tar.gz and extract it in the /srv/tftp as previous description. <span class="anchor" id="line-330"></span><span class="anchor" id="line-331"></span><p class="line867">
<h2 id="Potential_Issues">Potential Issues</h2>
<span class="anchor" id="line-332"></span><span class="anchor" id="line-333"></span><p class="line874">If the kernel in the netboot image gets out of sync with the kernel module packages, then the modules won't load and the install will fail, the usual symptoms are that messages about &quot;missing symbols&quot; appear in the ctrl-alt-f4 console. <span class="anchor" id="line-334"></span><span class="anchor" id="line-335"></span><p class="line874">To fix this, update the kernel and initrd on the netboot server. <span class="anchor" id="line-336"></span><span class="anchor" id="line-337"></span><p class="line874">There is probably a Debian BTS issue open for this, but I can't find it now. <span class="anchor" id="line-338"></span><span class="anchor" id="line-339"></span><p class="line867">
<h2 id="See_Also">See Also</h2>
<span class="anchor" id="line-340"></span><span class="anchor" id="line-341"></span><ul><li><p class="line891"><a class="http" href="http://www.debian.org/releases/stable/amd64/ch04s05">http://www.debian.org/releases/stable/amd64/ch04s05</a> - Debian Installation Guide - 4.5. Preparing Files for TFTP Net Booting <span class="anchor" id="line-342"></span></li><li><p class="line891"><a class="interwiki" href="https://packages.debian.org/di-netboot-assistant" title="DebianPkg">di-netboot-assistant</a> automates most of the steps described above: <a href="/DebianInstaller/NetbootAssistant">DebianInstaller/NetbootAssistant</a> <span class="anchor" id="line-343"></span></li><li><p class="line862">The Lenny installer in <tt class="backtick">netboot.tar.gz</tt> does NOT support installing using serial console by default now. More information on this issue, and a patch to enable serial console access, can be found in <a class="interwiki" href="https://bugs.debian.org/309223" title="DebianBug">309223</a>. <span class="anchor" id="line-344"></span></li><li><p class="line891"><a class="https" href="https://networkboot.org/">https://networkboot.org/</a> <span class="anchor" id="line-345"></span></li></ul><span class="anchor" id="bottom"></span></div><div id="pagebottom"></div>
</div>


<div id="footer">
<p id="pageinfo" class="info" lang="en" dir="ltr">PXEBootInstall  (<a class="nbinfo" href="/PXEBootInstall?action=info" rel="nofollow">last modified 2020-10-18 19:10:27</a>)</p>

<ul id="credits">
<li><a href="https://www.debian.org/legal/privacy">Debian privacy policy</a><br></li><li><a href="https://moinmo.in/" title="This site uses the MoinMoin Wiki software.">MoinMoin Powered</a></li><li><a href="https://moinmo.in/Python" title="MoinMoin is written in Python.">Python Powered</a></li><li>Debian Wiki <a href="/Teams/DebianWiki">team</a>, <a href="https://bugs.debian.org/wiki.debian.org">bugs</a> and <a href="https://salsa.debian.org/debian/wiki.debian.org">config</a> available.</li><li>Hosting provided by <a href="https://www.man-da.de/">Metropolitan Area Network Darmstadt</a></li>
</ul>


</div>
</body>
</html>

